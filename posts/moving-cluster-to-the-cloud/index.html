<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Moving My Cluster to the Cloud | Josh Kasuboski</title><meta name=description content="Josh Kasuboski's personal site"><meta name=author content><link rel=me href=mailto:josh.kasuboski@gmail.com><link rel=me href=https://github.com/kasuboski><link data-proofer-ignore rel=authorization_endpoint href=https://indieauth.com/auth><link rel=token_endpoint href=https://tokens.indieauth.com/token><link data-proofer-ignore rel=microsub href=https://microsub.joshcorp.co/microsub><link rel=alternate type=application/rss+xml href=https://www.joshkasuboski.com/index.xml><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://unpkg.com/turretcss/dist/turretcss.min.css crossorigin=anonymous><style>@media only screen and (min-width:768px){:root{font-size:18px}}body{background-color:#faf9fa}pre{background-color:#d4f2e1}a{text-decoration-color:#5965f9}#site-header{box-shadow:0 4px 12px 0 rgba(0,0,0,.05)}#intro{background-color:#e6e8fe}#social a{color:transparent;text-decoration:none}</style></head><body><div class=padding-bottom-s><header id=site-header><div class="container max-width-l flex-justify-center padding-vertical-xs"><h1 class=no-margin-bottom><a class="text-decoration-none flex align-items-center" href=https://www.joshkasuboski.com/><img alt="jk logo" class="icon-s margin-right-xs" src=https://www.joshkasuboski.com/images/jk-logo.svg><small>Josh Kasuboski</small></a></h1><nav class=nav-inline><ul><li><a href=/about/>About</a></li><li><a href=/now/>Now</a></li></ul></nav></div></header><main class="container max-width-l margin-top-l"><article class=h-entry><header><h1 class="display-title-xl no-margin-bottom post-title p-name">Moving My Cluster to the Cloud</h1><p class="post-date no-margin-top">Posted on
<time class=dt-published datetime=2021-08-05T22:06:31-05:00>5 August, 2021</time> by <a href=https://www.joshkasuboski.com/ class="p-author h-card" rel=author>Josh Kasuboski</a> ¬∑ 4min read</p></header><section class="content e-content margin-top-l"><p>I was going to move and didn't want to be without my rss reader (which I self host). To the cloud ‚òÅÔ∏è it is.</p><h2 id=searching-for-free-vms>Searching for Free VMs</h2><p>I had been thinking of using the generous Oracle free-tier to run a k3s cluster. Especially since they recently announced a free 4x24 ARM node. The entrypoint to my homelab has already been moved from Linode to a free Oracle VM. I wasn't able to get the free ARM node in my always-free account. I added a payment method and was able to provision it in a not always free region. The compute is free, but I pay for the disk which is like $2 a month.</p><p>I had originally been thinking to use Postgresql as the storage for k3s, but it was using a ton of bandwidth between the Linode and Oracle. That's less of a concern now that I'm not using Linode, but I think I'll stick with sqlite. I'm less worried about their being an issue with it since it's hosted on a cloud VM.</p><h2 id=setting-up-the-cluster>Setting up the Cluster</h2><p>I ended up buying a VPS from RackNerd as part of a special for around $1.25 per month. It's 3x2.5 and comes with 6.5TB of bandwidth. I put the k3s server on there and am using the giant ARM node as only an agent.</p><p>This time for my cluster, I set up Tailscale first. I then had the api server bind to the Tailscale interface so it's only accessible while connected to tailscale. This made my cilium networking not quite work and I ended up going back to their default tunnel option. Then it just worked.</p><p>Since my cluster was already managed in git, I was able to just create a new branch and configure it for the new cluster. I took this time to move <a href=https://github.com/kasuboski/k8s-gitops/tree/main>k8s-gitops</a> to using main as the default branch. Once I'm settled after the move I plan to add my Raspberry Pis and small form factor PCs to the cluster as well. One of the small form factor PCs will actually be moving to a different state as a backup.</p><h2 id=finally-getting-the-rss-reader>Finally Getting the RSS Reader</h2><p>After I had the cluster up and running, I was able to use my existing kubernetes yaml to deploy miniflux. I did need to reencrypt the secrets so that it would work with the key on the new cluster. I'm still thinking to use a separate secrets management solution, but haven't gotten around to it. Even though I now have cloud disks, I still didn't really want to manage the miniflux Postgresql database. My previous attempts to find a free postgres didn't pan out with <a href=https://www.joshkasuboski.com/posts/migrating-to-free-heroku-postgres/>heroku</a>.</p><p>I found that <a href=https://supabase.io/pricing>Supabase</a> has a very nice free plan. The database you get also gives you full access. I ended up configuring the miniflux database the same way I did when running it myself. Transferring the data went smoothly. I scaled down miniflux in the existing cluster and then used standard postgres backup and import tools to go from the one I hosted to Supabase. After adding the new connection info to the miniflux secret, it just worked üßô.</p><h2 id=moving-forward>Moving Forward</h2><p>I still need to set everything up at my new place and join them to the cluster. There are a bunch of things that I don't want to run in the cloud, so I'm still deciding if I want to taint the cloud nodes and use tolerations or just rely on affinities. I did already label the cloud nodes with a topology region of cloud so I can use it for scheduling. Ultimately, I'm hoping I can have it so things that can run anywhere will be able to bounce between going whereever is most efficient.</p><p>I'd also like to setup a separate ingress that is local only so I'm not always going out and back in to access cluster apps.</p></section><footer class=margin-top-m><a class="permalink u-url text-decoration-none" href=https://www.joshkasuboski.com/posts/moving-cluster-to-the-cloud/>üîó</a></footer></article><nav class="margin-top-l flex justify-content-space-around"><div></div><div class=show-s-up><a data-proofer-ignore alt="Top of page" href=#>Top</a></div><div><a alt="Older article" href=https://www.joshkasuboski.com/posts/migrating-to-free-heroku-postgres/>Migrating to Free Heroku Postgres (or not) &rarr;</a></div></nav></main><footer class="container max-width-l margin-top-xl"><div class=margin-bottom-m><h4>Get more of my thoughts in an email newsletter!</h4><form action=https://buttondown.email/api/emails/embed-subscribe/kasuboski method=post target=popupwindow onsubmit="window.open('https://buttondown.email/kasuboski','popupwindow')" class=embeddable-buttondown-form><label for=bd-email>Your Email</label>
<input type=email name=email id=bd-email placeholder=me@email.com></input>
<input type=hidden value=1 name=embed></input>
<button class="button button-primary button-border" type=submit value=Subscribe>Subscribe</button><p class=font-size-s><a href=https://buttondown.email target=_blank>Powered by Buttondown.</a></p></form></div><div class="box-shadow-l padding-m"><div class="h-card flex align-content-center"><figure class=icon-xxl><img alt="profile photo" class=u-photo src=https://www.joshkasuboski.com/img/josh-scotland.jpg></figure><div class=margin-left-m><h3 class=display-title><a class="u-url p-name text-decoration-none" href=https://www.joshkasuboski.com/>Josh Kasuboski</a></h3><p>Living in Austin <img class=icon-xs style=vertical-align:middle alt=texas src=https://www.joshkasuboski.com/img/tx-fill.png> from <img class=icon-xs style=vertical-align:middle alt=wisconsin src=https://www.joshkasuboski.com/img/wi-fill.png></p><p id=social><a rel=me class="u-url margin-right-xs" href=https://github.com/kasuboski><img class=icon-xs src=https://www.joshkasuboski.com/icons/github.svg alt=github></a>
<a class=margin-right-xs href=https://linkedin.com/in/joshkasuboski/><img class=icon-xs src=https://www.joshkasuboski.com/icons/linkedin.svg alt=linkedin></a>
<a href=mailto:josh.kasuboski@gmail.com class="u-email margin-right-xxs" rel=me><img class=icon-xs src=https://www.joshkasuboski.com/icons/envelope.svg alt=email></a>
<a href=https://www.joshkasuboski.com/payments/><img class=icon-xs src=https://www.joshkasuboski.com/icons/beer-money-icon.svg alt=beermoney></a></p></div></div></div></footer></div><script async src="https://cdn.panelbear.com/analytics.js?site=FK681rNQuKp"></script><script>window.panelbear=window.panelbear||function(){window.panelbearQ=window.panelbearQ||[];panelbearQ.push(arguments);};panelbear('config',{site:'FK681rNQuKp'});</script></body></html>