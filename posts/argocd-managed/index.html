<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Managing the Cluster with ArgoCD | Josh Kasuboski</title><meta name=description content="Josh Kasuboski's personal site"><meta name=author content><link rel=me href=mailto:josh.kasuboski@gmail.com><link rel=me href=https://github.com/kasuboski><link rel=authorization_endpoint href=https://indieauth.com/auth><link rel=token_endpoint href=https://tokens.indieauth.com/token><link rel=microsub href=https://microsub.joshcorp.co/microsub><link rel=alternate type=application/rss+xml href=https://www.joshkasuboski.com/index.xml><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://unpkg.com/turretcss/dist/turretcss.min.css crossorigin=anonymous><style>@media only screen and (min-width:768px){:root{font-size:18px}}body{background-color:#faf9fa}pre{background-color:#d4f2e1}a{text-decoration-color:#5965f9}#site-header{box-shadow:0 4px 12px 0 rgba(0,0,0,.05)}#intro{background-color:#e6e8fe}#social a{color:transparent;text-decoration:none}</style></head><body><div class=padding-bottom-s><header id=site-header><div class="container max-width-l flex-justify-center padding-vertical-xs"><h1 class=no-margin-bottom><a class="text-decoration-none flex align-items-center" href=https://www.joshkasuboski.com/><img class="icon-s margin-right-xs" src=https://www.joshkasuboski.com/images/jk-logo.svg><small>Josh Kasuboski</small></a></h1><nav class=nav-inline><ul><li><a href=/about/>About</a></li><li><a href=/now/>Now</a></li></ul></nav></div></header><main class="container max-width-l margin-top-l"><article class=h-entry><header><h1 class="display-title-xl no-margin-bottom post-title p-name">Managing the Cluster with ArgoCD</h1><p class="post-date no-margin-top">Posted on
<time class=dt-published datetime=2020-07-26T14:24:26-05:00>26 July, 2020</time> by <a href=https://www.joshkasuboski.com/ class="p-author h-card" rel=author>Josh Kasuboski</a> Â· 2min read</p></header><section class="content e-content margin-top-l"><p>I had to manually apply changes to my cluster, but now a lot of it is controlled from git thanks to ArgoCD.</p><h2 id=managed-with-a-cluster-repo>Managed with a cluster repo</h2><p>The cluster state is kept in <a href=https://github.com/kasuboski/k8s-gitops>kasuboski/k8s-gitops</a>. Each folder is a different function for the cluster. The gitops folder is special. It has the <a href=https://argoproj.github.io/projects/argo-cd>ArgoCD</a> manifests and the apps folder.</p><p>ArgoCD will sync manifests from a git repo to the cluster. It continuously watches to make sure the desired state (from git) matches the observed state (in the cluster). You configure ArgoCD using CRDs. Argo has Apps and Projects. A Project configures access for Apps and an App represents a repo that deploys Kubernetes objects.</p><p>You can see my apps at <a href=https://github.com/kasuboski/k8s-gitops/tree/master/gitops/apps>gitops/apps</a>. I use an app of apps <a href=https://argoproj.github.io/argo-cd/operator-manual/cluster-bootstrapping/#app-of-apps-pattern>pattern</a> to deploy. I apply this root &ldquo;apps&rdquo; app that then deploys the other apps for the cluster.</p><p>ArgoCD also comes with a dashboard that shows the apps and their status. You can also get a badge to put in the repo to show overall status.</p><p><img src="https://argocd.joshcorp.co/api/badge?name=apps&revision=true" alt></p><figure><a href=argo-dashboard.png><img src=argo-dashboard.png alt="The argo dashboard shows apps" width=800px></a></figure><h2 id=but-why>But why</h2><p>Managing Kubernetes like this (once everything is automated) allows me to stand up a cluster with the same state simply by installing ArgoCD and applying an ArgoCD App.</p><p>It also keeps me from accidentally messing with the cluster since even if I delete a Deployment ArgoCD will reapply it.</p></section><footer class=margin-top-m><a class="permalink u-url text-decoration-none" href=https://www.joshkasuboski.com/posts/argocd-managed/>ðŸ”—</a></footer></article><nav class="margin-top-l flex justify-content-space-around"><div><a alt="Newer article" href=https://www.joshkasuboski.com/posts/server-rack-2/>&larr; I Mounted My PC - Server Rack Update</a></div><div class=show-s-up><a alt="Top of page" href=#>Top</a></div><div><a alt="Older article" href=https://www.joshkasuboski.com/posts/gitops-cluster-1/>GitOpsing the cluster &rarr;</a></div></nav></main><footer class="container max-width-l margin-top-xl"><div class="box-shadow-l padding-m"><div class="h-card flex align-content-center"><figure class=icon-xxl><img class=u-photo src=https://www.joshkasuboski.com/img/josh-scotland.jpg></figure><div class=margin-left-m><h3 class=display-title><a class="u-url p-name text-decoration-none" href=https://www.joshkasuboski.com/>Josh Kasuboski</a></h3><p>Living in Austin <img class=icon-xs alt=texas src=https://www.joshkasuboski.com/img/texas.png> from <img class=icon-xs alt=wisconsin src=https://www.joshkasuboski.com/img/wisconsin.png></p><p id=social><a rel=me class="u-url margin-right-xs" href=https://github.com/kasuboski><img class=icon-xs src=https://www.joshkasuboski.com/icons/github.svg></a>
<a class=margin-right-xs href=https://linkedin.com/kasuboski><img class=icon-xs src=https://www.joshkasuboski.com/icons/linkedin.svg></a>
<a href=mailto:josh.kasuboski@gmail.com class="u-email margin-right-xxs" rel=me><img class=icon-xs src=https://www.joshkasuboski.com/icons/envelope.svg alt=email></a>
<button class="button button-icon button-xs" style=background-color:transparent;padding:0;border:0 id=checkout-button-beermoney role=link type=button>
<img class=icon-xs src=https://www.joshkasuboski.com/icons/beer-money-icon.svg alt=beermoney></button></p></div></div></div></footer></div><script>(function(f,a,t,h,o,m){a[h]=a[h]||function(){(a[h].q=a[h].q||[]).push(arguments)};o=f.createElement('script'),m=f.getElementsByTagName('script')[0];o.async=1;o.src=t;o.id='fathom-script';m.parentNode.insertBefore(o,m)})(document,window,'https://fathom.joshcorp.co/tracker.js','fathom');fathom('set','siteId','XFQVM');fathom('trackPageview');</script><script src=https://js.stripe.com/v3></script><script>(function(){var DOMAIN='https://www.joshkasuboski.com/';var key='pk_live_51HJtKkASjDZJS9C9Ja9g6zTFbaTEdW7uCK2OTK1dq741RisoSBtSIac1QEMphVCEEkA7hTeuopkUsajAyWuyH7kT00cU4iVGfX';var price='price_1HJtUTASjDZJS9C90kJjztUq';var stripe=Stripe(key);var checkoutButton=document.getElementById('checkout-button-beermoney');checkoutButton.addEventListener('click',function(){stripe.redirectToCheckout({lineItems:[{price:price,quantity:1}],mode:'payment',successUrl:DOMAIN+'success',cancelUrl:DOMAIN+'canceled',}).then(function(result){if(result.error){var displayError=document.getElementById('error-message');displayError.textContent=result.error.message;}});});})();</script></body></html>